import{r as f,w as T,c,v as V,a as l,x,y as n,A as i,z as E,f as C,g as w,D as A,o as p,n as M,s as S,F as D,b as B,k as $,p as _,e as I,t as b,B as j,m as z}from"./index-B6zlSGrq.js";import{_ as N,S as F}from"./SidebarMenu-CSgmmRR-.js";const G={class:"modal-panel"},O={class:"card p-4 shadow-sm"},P={class:"col-12"},J={class:"col-12"},L={class:"col-12"},q={class:"col-12"},H={class:"col-12"},K={class:"col-12"},Q={__name:"EditUserModal",props:{visible:Boolean,user:Object},emits:["close","submit"],setup(k,{emit:a}){const m=k,v=a,t=f(null);T(()=>m.user,d=>{d&&(t.value={...d})},{immediate:!0});function U(){if(t.value&&t.value.id)try{const d=C(w,"usuarios",t.value.id);A(d,{nombre:t.value.nombre,apellido:t.value.apellido,usuario:t.value.usuario,rut:t.value.rut,telefono:t.value.telefono,rol:t.value.rol}),y()}catch(d){console.error("Error al guardar cambios:",d)}}function y(){v("close")}return(d,e)=>k.visible&&t.value?(p(),c("div",{key:0,class:"modal-overlay",onClick:x(y,["self"])},[l("div",G,[l("div",O,[l("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e[6]||(e[6]=l("h2",{class:"mb-0"},"Editar Usuario",-1)),l("button",{class:"btn-close",onClick:y})]),l("form",{onSubmit:x(U,["prevent"]),class:"row g-3"},[l("div",P,[e[7]||(e[7]=l("label",{class:"form-label"},"Nombre",-1)),n(l("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>t.value.nombre=r),type:"text",class:"form-control"},null,512),[[i,t.value.nombre]])]),l("div",J,[e[8]||(e[8]=l("label",{class:"form-label"},"Apellido",-1)),n(l("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>t.value.apellido=r),type:"text",class:"form-control"},null,512),[[i,t.value.apellido]])]),l("div",L,[e[9]||(e[9]=l("label",{class:"form-label"},"Usuario",-1)),n(l("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>t.value.usuario=r),type:"text",class:"form-control"},null,512),[[i,t.value.usuario]])]),l("div",q,[e[10]||(e[10]=l("label",{class:"form-label"},"RUT",-1)),n(l("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.rut=r),type:"text",class:"form-control"},null,512),[[i,t.value.rut]])]),l("div",H,[e[11]||(e[11]=l("label",{class:"form-label"},"Teléfono",-1)),n(l("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>t.value.telefono=r),type:"text",class:"form-control"},null,512),[[i,t.value.telefono]])]),l("div",K,[e[13]||(e[13]=l("label",{class:"form-label"},"Rol",-1)),n(l("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>t.value.rol=r),class:"form-select"},e[12]||(e[12]=[l("option",{value:"administrador"},"Administrador",-1),l("option",{value:"profesor"},"Profesor",-1),l("option",{value:"estudiante"},"Estudiante",-1)]),512),[[E,t.value.rol]])]),e[14]||(e[14]=l("div",{class:"col-12"},[l("button",{class:"btn btn-success w-100 mt-2"},"Guardar Cambios")],-1))],32)])])])):V("",!0)}},W=N(Q,[["__scopeId","data-v-fddf4b63"]]),X={class:"grid"},Y={class:"container m-4 w-80 users-container"},Z={class:"col-md-4"},h={class:"col-md-4"},ll={class:"col-md-4"},ol={class:"col-md-3"},el={class:"col-md-3"},sl={class:"col-md-3"},tl={class:"col-md-3"},al={key:0,class:"table-responsive"},rl={class:"table table-striped"},nl={key:0,class:"badge bg-success"},ul=["onClick"],il=["onClick","disabled"],dl={__name:"UsersView",setup(k){const a=f({usuario:"",clave:"",nombre:"",apellido:"",rut:"",telefono:"",rol:"estudiante"}),m=f([]),v=f(null),t=f(!1),U=f(null),y=async()=>{try{await j($(w,"usuarios"),{...a.value}),alert("Usuario registrado exitosamente"),a.value={usuario:"",clave:"",nombre:"",apellido:"",rut:"",telefono:"",rol:"estudiante"}}catch(u){alert("Error: "+u.message)}};async function d(){const u=$(w,"usuarios");_(u,s=>{m.value=s.docs.map(g=>({id:g.id,...g.data()}))});const o=JSON.parse(sessionStorage.getItem("user"));o&&o.id&&(v.value=o.id)}async function e(u){if(u===v.value){alert("No puedes eliminar tu propio usuario.");return}try{await z(C(w,"usuarios",u)),m.value=m.value.filter(o=>o.id!==u)}catch(o){console.error("Error al eliminar usuario:",o)}}function r(u){U.value={...u},console.log(U.value),t.value=!0}async function R(u){}return M(()=>{d()}),(u,o)=>(p(),c("div",X,[S(F),l("div",Y,[o[12]||(o[12]=l("h3",{class:"mb-4"},"Gestion de Usuarios",-1)),l("form",{onSubmit:x(y,["prevent"]),class:"row g-2"},[l("div",Z,[n(l("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>a.value.usuario=s),class:"form-control",placeholder:"Nombre de usuario"},null,512),[[i,a.value.usuario]])]),l("div",h,[n(l("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>a.value.clave=s),class:"form-control",placeholder:"Contraseña",type:"password"},null,512),[[i,a.value.clave]])]),l("div",ll,[n(l("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>a.value.rol=s),class:"form-select"},o[8]||(o[8]=[l("option",{value:"estudiante"},"Estudiante",-1),l("option",{value:"profesor"},"Profesor",-1),l("option",{value:"administrador"},"Administrador",-1)]),512),[[E,a.value.rol]])]),l("div",ol,[n(l("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>a.value.nombre=s),class:"form-control",placeholder:"Nombre"},null,512),[[i,a.value.nombre]])]),l("div",el,[n(l("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>a.value.apellido=s),class:"form-control",placeholder:"Apellido"},null,512),[[i,a.value.apellido]])]),l("div",sl,[n(l("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>a.value.rut=s),class:"form-control",placeholder:"RUT"},null,512),[[i,a.value.rut]])]),l("div",tl,[n(l("input",{"onUpdate:modelValue":o[6]||(o[6]=s=>a.value.telefono=s),class:"form-control",placeholder:"Teléfono"},null,512),[[i,a.value.telefono]])]),o[9]||(o[9]=l("div",{class:"col-md-12"},[l("button",{class:"btn btn-success"},"Registrar")],-1))],32),o[13]||(o[13]=l("hr",null,null,-1)),m.value.length?(p(),c("div",al,[o[11]||(o[11]=l("h4",null,"Usuarios Registrados",-1)),l("table",rl,[o[10]||(o[10]=l("thead",null,[l("tr",null,[l("th",null,"Usuario"),l("th",null,"Nombre"),l("th",null,"Apellido"),l("th",null,"RUT"),l("th",null,"Teléfono"),l("th",null,"Rol"),l("th",null,"Acciones")])],-1)),l("tbody",null,[(p(!0),c(D,null,B(m.value,s=>(p(),c("tr",{key:s.id},[l("td",null,[I(b(s.usuario)+" ",1),s.id===v.value?(p(),c("span",nl,"yo")):V("",!0)]),l("td",null,b(s.nombre),1),l("td",null,b(s.apellido),1),l("td",null,b(s.rut),1),l("td",null,b(s.telefono),1),l("td",null,b(s.rol),1),l("td",null,[l("button",{class:"btn btn-sm btn-primary me-2",onClick:g=>r(s)},"Editar",8,ul),s.id!=v.value?(p(),c("button",{key:0,class:"btn btn-sm btn-danger",onClick:g=>e(s.id),disabled:s.id===v.value}," Eliminar ",8,il)):V("",!0)])]))),128))])]),S(W,{visible:t.value,user:U.value,onSubmit:R,onClose:o[7]||(o[7]=s=>t.value=!1)},null,8,["visible","user"])])):V("",!0)])]))}},cl=N(dl,[["__scopeId","data-v-c3bae24f"]]);export{cl as default};

import{r as c,H as P,I as $,n as j,i as J,f as A,k as V,q as k,l as m,j as _,w as Q,c as e,s as T,a,e as r,t as i,v as N,F as B,b as R,y as U,z,A as H,g,D as E,J as K,o as n,K as O}from"./index-B6zlSGrq.js";import{_ as G,S as W}from"./SidebarMenu-CSgmmRR-.js";const X={class:"grid"},Y={class:"container mt-4"},Z={class:"asignatura-detail"},h={key:0},ss={key:1,class:"text-muted"},as=["onClick"],ts={class:"mt-4"},os={class:"row mb-3"},es={class:"col-md-3"},ns={class:"col-md-6"},is={class:"list-group"},rs=["onClick"],ls={__name:"AsignaturaDetailsView",setup(us){const M=P(),b=c(null),l=c(null),x=c([]),p=c("profesor"),f=c(""),D=c([]),u=M.params.id,C=JSON.parse(sessionStorage.getItem("user"))?.rol==="administrador",F=$(()=>D.value.filter(o=>{const s=Array.isArray(o.asignaturas)&&o.asignaturas.includes(u);return(o.nombre+" "+o.apellido).toLowerCase().includes(f.value.toLowerCase())&&!s})),v=async()=>{const o=V(g,"usuarios"),s=k(o,m("rol","==",p.value)),t=await _(s);D.value=t.docs.map(d=>({id:d.id,...d.data()}))},I=async o=>{const s=A(g,"usuarios",o);await E(s,{asignaturas:O(u)}),await y(),await v(),alert("Asignado exitosamente")};j(async()=>{await y(),await v()});const y=async()=>{const o=await J(A(g,"asignaturas",u));b.value=o.exists()?o.data():null;const s=V(g,"usuarios"),t=k(s,m("rol","==","profesor"),m("asignaturas","array-contains",u)),d=k(s,m("rol","==","estudiante"),m("asignaturas","array-contains",u)),w=await _(t),L=await _(d);l.value=w.empty?null:{id:w.docs[0].id,...w.docs[0].data()},x.value=L.docs.map(q=>({id:q.id,...q.data()}))};Q(p,v,{immediate:!0});const S=async o=>{if(!confirm("¿Deseas eliminar esta asignación?"))return;const t=A(g,"usuarios",o);await E(t,{asignaturas:K(u)}),await y(),await v()};return(o,s)=>(n(),e("div",X,[T(W),a("div",Y,[a("div",Z,[a("div",null,[s[7]||(s[7]=a("h3",null,"Detalle de Asignatura",-1)),a("p",null,[s[3]||(s[3]=a("strong",null,"Nombre:",-1)),r(" "+i(b.value?.nombre),1)]),a("p",null,[s[4]||(s[4]=a("strong",null,"Código:",-1)),r(" "+i(b.value?.codigo),1)]),s[8]||(s[8]=a("h5",{class:"mt-4"},"Profesor",-1)),l.value?(n(),e("p",h,[r(i(l.value.nombre)+" "+i(l.value.apellido)+" ",1),C&&l.value?(n(),e("button",{key:0,class:"btn btn-sm btn-outline-danger",onClick:s[0]||(s[0]=t=>S(l.value.id))},s[5]||(s[5]=[r(" Quitar"),a("i",{class:"bi bi-x-lg"},null,-1)]))):N("",!0)])):(n(),e("p",ss,"No asignado")),s[9]||(s[9]=a("h5",{class:"mt-4"},"Estudiantes",-1)),a("ul",null,[(n(!0),e(B,null,R(x.value,t=>(n(),e("li",{key:t.id},[r(i(t.nombre)+" "+i(t.apellido)+" ",1),C?(n(),e("button",{key:0,class:"btn btn-sm btn-outline-danger",onClick:d=>S(t.id)},s[6]||(s[6]=[r(" Quitar"),a("i",{class:"bi bi-x-lg"},null,-1)]),8,as)):N("",!0)]))),128))])]),a("div",null,[a("div",ts,[s[11]||(s[11]=a("h4",null,"Agregar Profesor o Estudiante a la Asignatura",-1)),a("div",os,[a("div",es,[U(a("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>p.value=t),class:"form-select"},s[10]||(s[10]=[a("option",{value:"profesor"},"Profesor",-1),a("option",{value:"estudiante"},"Estudiante",-1)]),512),[[z,p.value]])]),a("div",ns,[U(a("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>f.value=t),class:"form-control",placeholder:"Buscar por nombre"},null,512),[[H,f.value]])])]),a("ul",is,[(n(!0),e(B,null,R(F.value,t=>(n(),e("li",{key:t.id,class:"list-group-item d-flex justify-content-between align-items-center"},[r(i(t.nombre)+" "+i(t.apellido)+" ",1),a("button",{class:"btn btn-sm btn-success",onClick:d=>I(t.id)},"Agregar",8,rs)]))),128))])])])])])]))}},gs=G(ls,[["__scopeId","data-v-5bd59fd9"]]);export{gs as default};
